---
id: 1
title: Setting up Users
excerpt: Setting up users correctly with supabase requires a few steps to start
type: supabase
card_image: /supabase.png
post_image: /supabase.png
inspiration: https://supabase.com/project/idsifamzvzlpgnmlnldw/editor/29363?sort=id%3Aasc
published: 15 May 2023
---

## Setting up Users

For the sake of clarity, here's what we're aiming to do:

- Create a new table `public.user_profiles` that uses the `id` from `auth.users` as its own primary
  key.
- Set up a foreign key constraint to ensure that every `user_profiles` row references a valid
  `auth.users` row.

There are several benefits of using `auth.id` from the `auth.users` table as a reference in your
`public.profiles` table:

1. **Identity Consistency:** By using `auth.id` as a reference, you ensure that each profile has a
   unique and consistent identifier that matches exactly with the associated user in the
   `auth.users` table. This provides a reliable link between authentication data and user profile
   data.

2. **Data Integrity:** By creating a foreign key relationship between `public.user_profiles` and
   `auth.users`, you're enforcing referential integrity. This means that the database ensures that
   all `id`s in the `public.user_profiles` table correspond to valid, existing `id`s in the
   `auth.users` table. It prevents orphaned records (i.e., a profile without a corresponding user)
   and protects your application from inconsistencies.

3. **Simplified Queries:** Having a direct reference between these tables simplifies the process of
   writing SQL queries. You can easily join the `auth.users` table and the `public.user_profiles`
   table on the `id` column to retrieve comprehensive user data.

4. **Security:** The `auth.users` table is managed by Supabase and has additional security measures
   to protect sensitive data, such as password hashes. By keeping profile information in a separate
   table and linking via `id`, you can freely query the `public.user_profiles` table without
   exposing sensitive authentication data.

5. **Scalability:** If your application grows in complexity and you need to add more tables that
   associate data with specific users (e.g., orders, posts, comments), having a consistent user `id`
   across all these tables will be crucial. The `auth.id` is a reliable, existing unique identifier
   that you can use for this purpose.

In summary, using `auth.id` as a reference in your `public.user_profiles` table maintains data
integrity, simplifies queries, enhances security, and supports the potential scalability of your
application.


## Here's how you would do it:

1. **Go to your Supabase dashboard:** After you've logged into your Supabase account, select your
   project. You will be brought to the dashboard.

2. **Open the SQL editor:** In the left-hand side menu, click on "SQL". This will open up the SQL
   editor where you can run custom SQL queries.

3. **Create the user_profiles table:** To create a table with a foreign key, you would use a
   `CREATE TABLE` query with a `FOREIGN KEY` constraint.

Here's an example of the SQL query you'd use:

```sql
CREATE TABLE public.user_profiles (
 auth_id uuid PRIMARY KEY REFERENCES auth.users(id),
 -- Add other relavent columns here, eg.
 email text,
 given_name text,
 surname text,
 username text,
 dob date,
 gender_id integer,
 avatar text,
 created_at timestamptz,
 updated_at timestamptz,
 last_seen timestamptz,
);
```

The `id` column is of type `uuid` because that's what Supabase uses for `auth.users`' `id`. This
`id` column is also the primary key for `public.user_profiles`, and it references the `id` in
`auth.users`. So, whenever you insert a row into `public.user_profiles`, you will need to provide a
valid `id` from `auth.users`.

You can replace `/* Add other columns here */` with any other columns you want in your user_profiles
table. For instance, if you want to store the user's full name and bio, you might add
`full_name text, bio text`.

After you've written your SQL query, click "Run" to execute it. Your `public.user_profiles` table
will be created.

4. **Check the table:** Click on the "Table Editor" in the left-hand side menu and select the
   `public.user_profiles` table from the dropdown at the top of the page. You should see your newly
   created table.

Remember that when you add a row to this table, you must provide a `uuid` that exists in the
`auth.users` table.

That's it! You've set up your `public.user_profiles` table to reference the `auth.users` table.
